name: üîë Test SSH Authentication

on:
  push:
    branches: [ main ]

jobs:
  test-auth:
    runs-on: ubuntu-latest
    steps:
    - name: üîë Test SSH Connection
      run: |
        mkdir -p ~/.ssh
        chmod 700 ~/.ssh
        
        # Guardar la clave privada
        echo "${{ secrets.SERVER_SSH_KEY }}" > ~/.ssh/test_key
        chmod 600 ~/.ssh/test_key
        
        echo "=== Key format check ==="
        head -2 ~/.ssh/test_key
        
        echo "=== Testing SSH connection ==="
        ssh -i ~/.ssh/test_key \
            -o StrictHostKeyChecking=no \
            -o ConnectTimeout=10 \
            -p 5655 \
            ${{ secrets.SERVER_USER }}@${{ secrets.SERVER_HOST }} \
            "echo '‚úÖ SUCCESS: Authenticated!'" || echo "‚ùå FAILED: Authentication"
